(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{591:function(s,a,t){"use strict";t.r(a);var n=t(10),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"分析-source-map"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分析-source-map"}},[s._v("#")]),s._v(" 分析 source-map")]),s._v(" "),t("p",[s._v("内容主要来自阮一峰的"),t("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("《Javascript Source Map 详解》"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"_3-1-source-map-长什么样子呢"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-source-map-长什么样子呢"}},[s._v("#")]),s._v(" 3.1.source-map 长什么样子呢？")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"version"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"file"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"js/bundle.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mappings"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('";;;;;AAAA;AACA;AACA,C"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sources"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"webpack://source-map/./src/index.js"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sourcesContent"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"function sayHello(name) {\\r\\n  console.log('hello,', name)\\r\\n}\"")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"names"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sourceRoot"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("解释")]),s._v(" "),t("ul",[t("li",[s._v("version：Source map 的版本，目前为 3。")]),s._v(" "),t("li",[s._v("sources：从哪些文件转换过来的 source-map 和打包的代码（最初始的文件）。该项是一个数组，表示可能存在多个文件合并。")]),s._v(" "),t("li",[s._v("names：转换前的所有变量名和属性名（因为我目前使用的是 development 模式，所以不需要保留转换前的名称）。")]),s._v(" "),t("li",[s._v("mappings：记录位置信息的字符串。")]),s._v(" "),t("li",[s._v("file：转换后的文件名。")]),s._v(" "),t("li",[s._v("sourceRoot：转换前的文件所在的目录。如果与转换前的文件在同一目录，该项为空。")]),s._v(" "),t("li",[s._v("sourceContent：转换前的具体代码信息（和 sources 是对应的关系）；")])]),s._v(" "),t("h3",{attrs:{id:"_3-2-mappings属性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-mappings属性"}},[s._v("#")]),s._v(" 3.2.mappings"),t("strong",[s._v("属性")])]),s._v(" "),t("p",[s._v("两个文件的各个位置是如何一一对应的。")]),s._v(" "),t("p",[s._v("关键就是map文件的mappings属性。这是一个很长的字符串，它分成三层。这是一个很长的字符串，它分成三层。")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("p",[s._v("第一层是行对应，以分号（;）表示，每个分号对应转换后源码的一行。所以，第一个分号前的内容，就对应源码的第一行，以此类推。")]),s._v(" "),t("p",[s._v("第二层是位置对应，以逗号（,）表示，每个逗号对应转换后源码的一个位置。所以，第一个逗号前的内容，就对应该行源码的第一个位置，以此类推。")]),s._v(" "),t("p",[s._v("第三层是位置转换，以 VLQ 编码表示，代表该位置对应的转换前的源码位置。")])]),t("p",[s._v("举例来说，假定 mappings 属性的内容如下：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('　mappings:"AAAAA,BBBBB;CCCCC"\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("就表示，转换后的源码分成两行，第一行有两个位置，第二行有一个位置。")]),s._v(" "),t("h3",{attrs:{id:"_3-3-位置对应原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-位置对应原理"}},[s._v("#")]),s._v(" 3.3.位置对应原理")]),s._v(" "),t("p",[s._v("每个位置使用五位，表示五个字段。")]),s._v(" "),t("p",[s._v("从左边算起:")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("ul",[t("li",[t("p",[s._v("第一位，表示这个位置在（转换后的代码的）的第几列。")])]),s._v(" "),t("li",[t("p",[s._v("第二位，表示这个位置属于 sources 属性中的哪一个文件。")])]),s._v(" "),t("li",[t("p",[s._v("第三位，表示这个位置属于转换前代码的第几行。")])]),s._v(" "),t("li",[t("p",[s._v("第四位，表示这个位置属于转换前代码的第几列。")])]),s._v(" "),t("li",[t("p",[s._v("第五位，表示这个位置属于 names 属性中的哪一个变量。")])])])]),t("p",[s._v("有几点需要说明。首先，所有的值都是以 0 作为基数的。其次，第五位不是必需的，如果该位置没有对应 names 属性中的变量，可以省略第五位。再次，每一位都采用 VLQ 编码表示；由于 VLQ 编码是变长的，所以每一位可以由多个字符构成。")]),s._v(" "),t("p",[s._v("如果某个位置是 AAAAA，由于 A 在 VLQ 编码中表示 0，因此这个位置的五个位实际上都是 0。它的意思是，该位置在转换后代码的第 0 列，对应 sources 属性中第 0 个文件，属于转换前代码的第 0 行第 0 列，对应 names 属性中的第 0 个变量。")]),s._v(" "),t("h3",{attrs:{id:"_3-4-vlq-编码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-vlq-编码"}},[s._v("#")]),s._v(" 3.4.VLQ 编码")]),s._v(" "),t("p",[t("a",{attrs:{href:"http://www.qiutianaimeili.com/html/page/2019/05/89jrubx1soc.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考链接"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("这种编码最早用于 MIDI 文件，后来被多种格式采用。它的特点就是可以非常精简地表示很大的数值。")]),s._v(" "),t("p",[s._v("VLQ 编码是变长的。如果（整）数值在-15 到+15 之间（含两个端点），用一个字符表示；超出这个范围，就需要用多个字符表示。它规定，每个字符使用 6 个两进制位，正好可以借用"),t("a",{attrs:{href:"https://en.wikipedia.org/wiki/Base_64",target:"_blank",rel:"noopener noreferrer"}},[s._v("Base 64"),t("OutboundLink")],1),s._v("编码的字符表。")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://img.viini.cn/img/202201131117022.png",alt:"img"}})]),s._v(" "),t("p",[s._v('在这 6 个位中，左边的第一位（最高位）表示是否"连续"（continuation）。如果是 1，代表这６个位后面的 6 个位也属于同一个数；如果是 0，表示该数值到这 6 个位结束。')]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("　Continuation\n　　"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("　　　　　Sign\n　　"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("　　　　　"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("V")]),s._v("　　　　　"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("V")]),s._v("\n　　１０１０１１\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v('这 6 个位中的右边最后一位（最低位）的含义，取决于这 6 个位是否是某个数值的 VLQ 编码的第一个字符。如果是的，这个位代表"符号"（sign），0 为正，1 为负（Source map 的符号固定为 0）；如果不是，这个位没有特殊含义，被算作数值的一部分。')])])}),[],!1,null,null,null);a.default=e.exports}}]);