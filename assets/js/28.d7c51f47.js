(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{590:function(s,a,t){"use strict";t.r(a);var n=t(10),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"_1-什么是-source-map"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是-source-map"}},[s._v("#")]),s._v(" 1.什么是 source-map")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("一般我们编译的代码是运行在浏览器时，是通过打包压缩的; 也就是真实打包的代码和我们编写的代码是有差异的。")]),s._v(" "),t("ul",[t("li",[s._v("比如 es6 的代码会被转成 es5")]),s._v(" "),t("li",[s._v("代码对应的行列号和编译后的肯定会不一致")]),s._v(" "),t("li",[s._v("比如代码进行丑化压缩时，会将编码名称等修改")]),s._v(" "),t("li",[s._v("比如我们使用了 TypeScript 等方式编写的代码，最终转换成 JavaScript；")])])]),s._v(" "),t("li",[t("p",[s._v("但是，当代码报错需要调试时（debug），调试转换后的代码是很困难的")])]),s._v(" "),t("li",[t("p",[s._v("但是我们能保证代码不出错吗？不可能。")])]),s._v(" "),t("li",[t("p",[s._v("那么如何可以调试这种转换后不一致的代码呢？答案就是 source-map")]),s._v(" "),t("ul",[t("li",[s._v("source-map 是从已转换的代码，映射到原始的源文件")]),s._v(" "),t("li",[s._v("使浏览器可以重构原始源并在调试器中显示重建的原始源；")])])])]),s._v(" "),t("h2",{attrs:{id:"_2-生成-source-map"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-生成-source-map"}},[s._v("#")]),s._v(" 2.生成 source-map")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("如何在使用 webpack 打包的时候，生成对应的 source-map 呢？")]),s._v(" "),t("ul",[t("li",[t("p",[t("a",{attrs:{href:"https://webpack.docschina.org/configuration/devtool/",target:"_blank",rel:"noopener noreferrer"}},[s._v("webpack 官网文档"),t("OutboundLink")],1),s._v("为我们提供了非常多的选项（目前是 26 个），来处理 source-map；")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("devtool")]),s._v("选择不同的值，生成的 source-map 会稍微有差异，打包的过程也会有性能的差异，可以根据不同的情况进行选择；")])]),s._v(" "),t("li",[t("p",[s._v("其实多种配置只是5个关键字eval、source-map、cheap、module 和 inline 的组合罢了")])])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("关键字")]),s._v(" "),t("th",[s._v("含义")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("source-map")]),s._v(" "),t("td",[s._v("产生.map 文件")])]),s._v(" "),t("tr",[t("td",[s._v("eval")]),s._v(" "),t("td",[s._v("使用 eval 包裹模块代码，不生成 source-map，但是它会在 eval 执行的代码中，添加 //# sourceURL=；它会被浏览器在执行时解析，并且在调试面板中生成对应的一些文件目录，方便我们调试代码；")])]),s._v(" "),t("tr",[t("td",[s._v("cheap")]),s._v(" "),t("td",[s._v("不包含列信息（关于列信息的解释下面会有详细介绍)也不包含 loader 的 sourcemap")])]),s._v(" "),t("tr",[t("td",[s._v("module")]),s._v(" "),t("td",[s._v("包含 loader 的 sourcemap（比如 jsx to js ，babel 的 sourcemap）,否则无法定义源文件")])]),s._v(" "),t("tr",[t("td",[s._v("inline")]),s._v(" "),t("td",[s._v("将.map 作为 DataURI 嵌入，不单独生成.map 文件")])])])])])]),s._v(" "),t("p",[s._v("例如文件源代码如下：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("456")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[t("strong",[s._v("1.eval")])]),s._v(" "),t("p",[s._v("将"),t("code",[s._v("devtool")]),s._v("设置为"),t("code",[s._v("eval")]),s._v("打包后的代码：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("eval")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"console.log(123)\\r\\nconsole.log(456)\\r\\nconsole.log(a)\\n\\n//# sourceURL=webpack://source-map/./src/index.js?"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("在浏览器中显示如下：")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://img.viini.cn/img/202201171532062.png",alt:"image-20220117153235983"}})]),s._v(" "),t("p",[t("strong",[s._v("2.source-map")])]),s._v(" "),t("p",[s._v("会生成一个独立的"),t("code",[s._v("source-map")]),s._v("文件，并且在"),t("code",[s._v("bundle")]),s._v("文件中有一个注释，指向"),t("code",[s._v("source-map")]),s._v("文件；")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/******/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// webpackBootstrap")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" __webpack_exports__ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*!**********************!*\\\n  !*** ./src/index.js ***!\n  \\**********************/")]),s._v("\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("456")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/******/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//# sourceMappingURL=bundle.js.map ")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[t("img",{attrs:{src:"http://img.viini.cn/img/202201171539396.png",alt:"image-20220117153927358"}})]),s._v(" "),t("p",[t("strong",[s._v("3.inline")])]),s._v(" "),t("p",[s._v("对于"),t("code",[s._v("inline-source-map")]),s._v("而言，会生成"),t("code",[s._v("source-map")]),s._v("，但是"),t("code",[s._v("source-map")]),s._v("是以"),t("code",[s._v("DataUrl")]),s._v("添加到"),t("code",[s._v("bundle")]),s._v("文件的后面：")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://img.viini.cn/img/202201171701369.png",alt:"image-20220117170111329"}})]),s._v(" "),t("p",[t("strong",[s._v("4.cheap")])]),s._v(" "),t("p",[s._v("对于"),t("code",[s._v("cheap-source-map")]),s._v("而言会生成"),t("code",[s._v("source-map")]),s._v("，但是只会定义到出错的这一行，而不会定义到列；精准度降低换取文件内容的缩小。")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://img.viini.cn/img/202201171657468.png",alt:"image-20220117165729425"}})]),s._v(" "),t("p",[s._v("而对于"),t("code",[s._v("source-map")]),s._v("而言，则会精准到列")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://img.viini.cn/img/202201171657168.png",alt:"image-20220117153235983"}})]),s._v(" "),t("p",[t("strong",[s._v("存在的问题")])]),s._v(" "),t("ol",[t("li",[s._v("错误信息只会定义到行，而不会定义到列")]),s._v(" "),t("li",[s._v("对于经由 babel 之类工具转义的代码，只能定位到转换后的代码")])]),s._v(" "),t("p",[t("strong",[s._v("5.cheap-module-source-map")])]),s._v(" "),t("p",[s._v("对于"),t("code",[s._v("cheap-module-source-map")]),s._v("来说：会保留 loader 处理前后的文件信息映射，解决对于使用"),t("code",[s._v("cheap")]),s._v("配置项导致无法定位到 loader 处理前的源代码问题")]),s._v(" "),t("p",[s._v("测试代码")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("# sum\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("sum")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" b\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("debugger")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" sum"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n# index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" sum "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./sum'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sum"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("对于"),t("code",[s._v("cheap-source-map")]),s._v("而言，此时页面 debugger 展示源码是 es5 的代码，因为已经被 babal 转义了:")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://img.viini.cn/img/202201171728151.png",alt:"image-20220117172815115"}})]),s._v(" "),t("p",[s._v("对于"),t("code",[s._v("cheap-module-source-map")]),s._v("而言，则会精准到原始代码:")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://img.viini.cn/img/202201171729691.png",alt:"image-20220117172918664"}})]),s._v(" "),t("p",[t("strong",[s._v("5.hidden-source-map")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("会生成sourcemap，但是不会对source-map文件进行引用；")])]),s._v(" "),t("li",[t("p",[s._v("相当于删除了打包文件中对sourcemap的引用注释；")])]),s._v(" "),t("li",[t("p",[s._v("如果我们手动添加进来，那么sourcemap就会生效了")])])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 被删掉了")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//# sourceMappingURL=bundle.js.map ")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("strong",[s._v("6.nosources-source-map")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("会生成sourcemap，但是生成的sourcemap只有错误信息的提示，不会生成源代码文件")])]),s._v(" "),t("li",[t("p",[s._v("正确的错误提示：")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://img.viini.cn/img/202201171730002.png",alt:"image-20220117173043965"}})])]),s._v(" "),t("li",[t("p",[s._v("点击错误提示，无法查看源码：")])])]),s._v(" "),t("p",[t("img",{attrs:{src:"http://img.viini.cn/img/202201171731392.png",alt:"image-20220117173106366"}})]),s._v(" "),t("h2",{attrs:{id:"_3-总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-总结"}},[s._v("#")]),s._v(" 3.总结")]),s._v(" "),t("ul",[t("li",[s._v("事实上，webpack提供给我们的26个值，是可以进行多组合的。")]),s._v(" "),t("li",[s._v("组合的规则如下：\n"),t("ul",[t("li",[s._v("inline-|hidden-|eval：三个值时三选一；")]),s._v(" "),t("li",[s._v("nosources：可选值；")]),s._v(" "),t("li",[s._v("cheap可选值，并且可以跟随module的值；")])])])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("inline"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("hidden"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("eval"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nosources"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("cheap"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("module"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("source"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("map"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("那么在开发中，最佳的实践是什么呢？\n"),t("ul",[t("li",[s._v("开发阶段：推荐使用 source-map或者cheap-module-source-map")]),s._v(" "),t("li",[s._v("这分别是vue和react使用的值，可以获取调试信息，方便快速开发；")]),s._v(" "),t("li",[s._v("测试阶段：推荐使用 source-map或者cheap-module-source-map\n"),t("ul",[t("li",[s._v("测试阶段我们也希望在浏览器下看到正确的错误提示；")])])]),s._v(" "),t("li",[s._v("发布阶段：false、缺省值（不写）")])])])])])}),[],!1,null,null,null);a.default=e.exports}}]);